<!-- templates/admin/settings.html -->
{% extends "base.html" %}

{% block title %}Settings - Admin{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
{% endblock %}

{% block content %}
<div class="container">
    <h1>‚öôÔ∏è System Settings</h1>
    
    <div class="settings-sections">
        <!-- Phase Control -->
        <div class="settings-section">
            <h2>üìç Phase Control</h2>
            <div class="setting-item">
                <div class="setting-info">
                    <strong>Current Phase:</strong> Phase {{ settings.phase }}
                    <p>
                        {% if settings.phase == 1 %}
                        Registration phase - users can sign up
                        {% else %}
                        Assignment phase - users can reveal matches and chat
                        {% endif %}
                    </p>
                </div>
                <form method="POST" action="{{ url_for('admin_settings') }}">
                    <input type="hidden" name="action" value="update_phase">
                    <select name="phase" onchange="this.form.submit()">
                        <option value="1" {% if settings.phase == 1 %}selected{% endif %}>Phase 1</option>
                        <option value="2" {% if settings.phase == 2 %}selected{% endif %}>Phase 2</option>
                    </select>
                </form>
            </div>
            
            <div class="setting-item">
                <div class="setting-info">
                    <strong>Registration:</strong>
                    {% if settings.registration_open %}Open{% else %}Closed{% endif %}
                </div>
                <form method="POST" action="{{ url_for('admin_settings') }}">
                    <input type="hidden" name="action" value="toggle_registration">
                    <button type="submit" class="btn btn-secondary">
                        {% if settings.registration_open %}Close{% else %}Open{% endif %} Registration
                    </button>
                </form>
            </div>
            
            <div class="setting-item">
                <div class="setting-info">
                    <strong>Chat:</strong>
                    {% if settings.chat_enabled %}Enabled{% else %}Disabled{% endif %}
                </div>
                <form method="POST" action="{{ url_for('admin_settings') }}">
                    <input type="hidden" name="action" value="toggle_chat">
                    <button type="submit" class="btn btn-secondary">
                        {% if settings.chat_enabled %}Disable{% else %}Enable{% endif %} Chat
                    </button>
                </form>
            </div>
        </div>
        
        <!-- SMTP Settings -->
        <div class="settings-section">
            <h2>üìß Email (SMTP) Configuration</h2>
            <form method="POST" action="{{ url_for('admin_settings') }}">
                <input type="hidden" name="action" value="update_smtp">
                
                <div class="form-group">
                    <label for="smtp_host">SMTP Host</label>
                    <input type="text" id="smtp_host" name="smtp_host" 
                           value="{{ settings.smtp_host or '' }}" 
                           placeholder="smtp.gmail.com">
                </div>
                
                <div class="form-group">
                    <label for="smtp_port">SMTP Port</label>
                    <input type="number" id="smtp_port" name="smtp_port" 
                           value="{{ settings.smtp_port or 587 }}">
                </div>
                
                <div class="form-group">
                    <label for="smtp_user">SMTP Username/Email</label>
                    <input type="text" id="smtp_user" name="smtp_user" 
                           value="{{ settings.smtp_user or '' }}" 
                           placeholder="your-email@gmail.com">
                </div>
                
                <div class="form-group">
                    <label for="smtp_password">SMTP Password</label>
                    <input type="password" id="smtp_password" name="smtp_password" 
                           placeholder="Leave blank to keep current password">
                    <small class="form-help">Password is encrypted in database</small>
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" name="smtp_use_tls" 
                               {% if settings.smtp_use_tls %}checked{% endif %}>
                        Use TLS
                    </label>
                </div>
                
                <button type="submit" class="btn btn-primary">Save SMTP Settings</button>
            </form>
            
            <div class="setting-item" style="margin-top: 20px;">
                <h3>Test Email</h3>
                <form method="POST" action="{{ url_for('admin_settings') }}">
                    <input type="hidden" name="action" value="test_email">
                    <div class="form-group">
                        <input type="email" name="test_email" 
                               placeholder="Enter email to send test" required>
                    </div>
                    <button type="submit" class="btn btn-secondary">Send Test Email</button>
                </form>
            </div>
        </div>
        
        <!-- System Reset -->
        <div class="settings-section danger-zone">
            <h2>‚ö†Ô∏è Danger Zone</h2>
            <div class="setting-item">
                <div class="setting-info">
                    <strong>Reset System</strong>
                    <p>This will delete all participants, assignments, and messages. Use this to prepare for next year's Secret Santa.</p>
                </div>
                <form method="POST" action="{{ url_for('admin_settings') }}" 
                      onsubmit="return confirm('Are you absolutely sure? This cannot be undone!');">
                    <input type="hidden" name="action" value="reset_system">
                    <div class="form-group">
                        <input type="text" name="confirm_reset" 
                               placeholder="Type RESET to confirm" required>
                    </div>
                    <button type="submit" class="btn btn-danger">Reset System</button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}
